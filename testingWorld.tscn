[gd_scene load_steps=22 format=3 uid="uid://bhdo6gf8hksmp"]

[ext_resource type="PackedScene" uid="uid://n7p1mynbtqe2" path="res://environment/worlds/devRealm/devRealm.tscn" id="1_8cqxu"]
[ext_resource type="PackedScene" uid="uid://cbdlhd2682nf2" path="res://characters/playableCharacters/genericClass.tscn" id="2_ct547"]
[ext_resource type="PackedScene" uid="uid://bxq2rdalfohtw" path="res://ui/makeGearUiCell.tscn" id="5_l30hf"]
[ext_resource type="Texture2D" uid="uid://c1bqceo63l5kg" path="res://environment/chest.png" id="8_8wi3l"]
[ext_resource type="Texture2D" uid="uid://cqkcdtutppkba" path="res://items/hp-flask.png" id="11_3edqv"]
[ext_resource type="PackedScene" uid="uid://c85hm3mgk8xg7" path="res://items/destroyContainerOnEmpty.tscn" id="11_rddws"]
[ext_resource type="PackedScene" uid="uid://circ26mol7hsg" path="res://items/flaskOfPain.tscn" id="12_m0vpe"]
[ext_resource type="PackedScene" uid="uid://dcao3y338305p" path="res://scripts/toggleVisibilityOfTargetOnPlayerWalkOver.tscn" id="12_o62jj"]
[ext_resource type="PackedScene" uid="uid://cnkbrh3ihf3x5" path="res://abilities/dev-armor.tscn" id="13_7oxlg"]
[ext_resource type="PackedScene" uid="uid://c1r4djsndgyme" path="res://items/basicArmor1.tscn" id="13_42vnk"]
[ext_resource type="PackedScene" uid="uid://byypr3minse8e" path="res://abilities/weapons/crew_gun.tscn" id="13_e51y4"]
[ext_resource type="PackedScene" uid="uid://dau0p74mlw7o" path="res://items/containerInventoryDisplay.tscn" id="13_j0oet"]
[ext_resource type="PackedScene" uid="uid://ohxxvbakgamo" path="res://environment/generators/scatterObjectPlacer.tscn" id="16_knh61"]
[ext_resource type="PackedScene" uid="uid://dt2kb2yrwlot0" path="res://environment/smallRock1.tscn" id="17_n810x"]
[ext_resource type="PackedScene" uid="uid://cguieshd00n62" path="res://environment/smallBush.tscn" id="18_2or23"]
[ext_resource type="PackedScene" path="res://environment/worldPortal.tscn" id="18_d1gl8"]
[ext_resource type="PackedScene" uid="uid://b4wm1mjolckxd" path="res://enemies/dustMote.tscn" id="19_rmfwx"]
[ext_resource type="PackedScene" uid="uid://dt0l2qsjnfbnb" path="res://items/basicLootBag.tscn" id="20_0vsro"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_jx8xe"]
size = Vector2(6, 6)

[sub_resource type="GDScript" id="GDScript_jbbkt"]
script/source = "extends Node

var use_count = 0

func use_flask(user: Object):  
  var health = get_meta('health', 25)
  var max_uses = get_meta('max_uses', 1)
  
  Comp.run_method(user, 'heal_by', [health])
  
  use_count += 1
  if (max_uses > -1) and (use_count >= max_uses):
    queue_free()


func handle_left_clicked(event: InputEventMouse):
  get_viewport().set_input_as_handled()
  if Lib.is_dragging:
    return
  if not (event is InputEventMouseButton):
    return
  if event.pressed:
    return
  if event.button_index != MOUSE_BUTTON_LEFT:
    return
  #only when not dragging, and left button just released:
  use_flask(Lib.player_character)


















"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_vyrgn"]
size = Vector2(61.1742, 63.6997)

[node name="testWorld" type="Node2D" groups=["game_world"]]

[node name="devRealm" parent="." instance=ExtResource("1_8cqxu")]

[node name="genericClass" parent="." instance=ExtResource("2_ct547")]

[node name="genericEnemy" parent="." instance=ExtResource("19_rmfwx")]
position = Vector2(232.4, 183.569)

[node name="produceShotAbility" parent="genericEnemy" index="14"]
individual_shot_angle_spread = 22.5

[node name="Label" type="Label" parent="."]
z_index = -100
offset_left = 172.918
offset_top = 192.349
offset_right = 329.918
offset_bottom = 218.349
text = "genericEnemy
"

[node name="fanShootingEnemy" parent="." instance=ExtResource("19_rmfwx")]
position = Vector2(-55.6929, 184.725)

[node name="targetNearestEnemy" parent="fanShootingEnemy" index="6"]
collision_mask = 7

[node name="produceShotAbility" parent="fanShootingEnemy" index="14"]
shot_count = 3
multi_shot_type = "Cloud"
cloud_multishot_max_speedup_ratio = 0.8

[node name="Label2" type="Label" parent="."]
z_index = -100
offset_left = -127.64
offset_top = 191.265
offset_right = 29.36
offset_bottom = 217.265
text = "Fan shooting enemy"

[node name="devChest" type="Node2D" parent="." groups=["container", "gear_container"]]
position = Vector2(24.3341, 24.3171)
metadata/ui_gear_cells = 10
metadata/accepts_gear_drops = true

[node name="Sprite2D" type="Sprite2D" parent="devChest"]
scale = Vector2(0.75, 0.75)
texture = ExtResource("8_8wi3l")

[node name="containerDestroyOnEmpty" parent="devChest" instance=ExtResource("11_rddws")]

[node name="visibilityTogglerArea2D" type="Area2D" parent="devChest"]
scale = Vector2(0.75, 0.75)
collision_layer = 0
collision_mask = 3
metadata/target_node_path = NodePath("")

[node name="toggleVisibilityOfTargetOnPlayerWalkOver" parent="devChest/visibilityTogglerArea2D" instance=ExtResource("12_o62jj")]
target_node_path = NodePath("../../inventoryDisplay")

[node name="CollisionShape2D" type="CollisionShape2D" parent="devChest/visibilityTogglerArea2D"]
shape = SubResource("RectangleShape2D_jx8xe")

[node name="inventoryDisplay" parent="devChest" instance=ExtResource("13_j0oet")]

[node name="flaskOfPain" parent="devChest" instance=ExtResource("12_m0vpe")]
editor_description = "Hurts the user"
damage = 50
max_uses = -1

[node name="devArmor" parent="devChest" instance=ExtResource("13_7oxlg")]

[node name="gunCREW" parent="devChest" instance=ExtResource("13_e51y4")]

[node name="basicLootBag" parent="." instance=ExtResource("20_0vsro")]
position = Vector2(41.7174, -41.0777)
metadata/_edit_group_ = true

[node name="hpFlaskGear2" type="Node" parent="basicLootBag" groups=["ability", "gear"]]
editor_description = "meta:
  health: how much healed by; default 25
  max_uses: -1 for infinite, >0 for that many uses; default 1
  "
script = SubResource("GDScript_jbbkt")

[node name="makeGearUiCell" parent="basicLootBag/hpFlaskGear2" instance=ExtResource("5_l30hf")]

[node name="templateGearCell" type="TextureRect" parent="basicLootBag/hpFlaskGear2/makeGearUiCell"]
process_mode = 4
visible = false
z_index = 10
custom_minimum_size = Vector2(10, 10)
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
texture = ExtResource("11_3edqv")
expand_mode = 1
stretch_mode = 6

[node name="basicArmor" parent="basicLootBag" instance=ExtResource("13_42vnk")]

[node name="ashlandsWorldPortal" parent="." instance=ExtResource("18_d1gl8")]
position = Vector2(8.40524, -39.699)
metadata/world_file = "res://environment/worlds/ashlands/ashlandsWorld.tscn"
metadata/world_name = "The Ashlands"

[node name="ashlandsWorldPortal2" parent="." instance=ExtResource("18_d1gl8")]
position = Vector2(-25.0948, -39.699)
metadata/world_file = "res://environment/worlds/homeWorld/homeWorld.tscn"
metadata/world_name = "Home World"

[node name="ash" type="ColorRect" parent="."]
offset_left = 77.8825
offset_top = -30.5206
offset_right = 139.882
offset_bottom = 34.4794

[node name="StaticBody2D" type="StaticBody2D" parent="ash"]

[node name="CollisionShape2D" type="CollisionShape2D" parent="ash/StaticBody2D"]
position = Vector2(31.2005, 32.7325)
shape = SubResource("RectangleShape2D_vyrgn")

[node name="scatterObjectPlacer" parent="ash" instance=ExtResource("16_knh61")]
position = Vector2(30.8677, 33.9545)
spread = 50.0
count = 200

[node name="rockScenes" type="ResourcePreloader" parent="ash/scatterObjectPlacer"]
resources = [PackedStringArray("smallRock1"), [ExtResource("17_n810x")]]

[node name="bushScenes" type="ResourcePreloader" parent="ash/scatterObjectPlacer"]
resources = [PackedStringArray("smallBush"), [ExtResource("18_2or23")]]
metadata/generation_bias = -2.0

[editable path="genericEnemy"]
[editable path="fanShootingEnemy"]
